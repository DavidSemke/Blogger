(()=>{"use strict";function e(e,o,n){t(e,o);const r=`${e}__error-container`,s=document.getElementById(o).parentElement;if(n){const t=document.createElement("div");t.classList.add(r);for(const o of n){const n=document.createElement("div");n.classList.add(`${e}__error`),n.textContent=o.msg,t.append(n)}s.append(t)}}function t(e,t){const o=`${e}__error-container`,n=document.getElementById(t).parentElement,r=n.querySelector("."+o);r&&n.removeChild(r)}async function o(e,t,o,n=null){const r=await fetch(e,{method:t,body:new FormData(o)});if(!r.ok&&400!==r.status)throw new Error("HTTP error - Status 500");r.redirected&&(window.location.href===r.url?window.location.reload():window.location.href=r.url);const s=r.headers.get("content-type");s&&s.includes("application/json")&&n&&n(await r.json())}const n=function(){const e=function(){let e=null,t=null;return{enqueue:function(o){const n=function(e,t=null){return{value:e,next:t}}(o);e?(t.next=n,t=n):(e=n,t=n)},dequeue:function(){if(!e)return;const o=e;return e=e.next,e||(t=null),o.value},isEmpty:function(){return null===e}}}();let t=!1;return{enqueue:async function(o){if(e.enqueue(o),!t){for(t=!0;!e.isEmpty();){const t=e.dequeue();await t()}t=!1}}}}();function r(e,t){t.replies&&t.replies.length&&e.querySelector(".comment-card__view-replies-button").addEventListener("click",(()=>{const t=e.nextSibling;let o=t;t.classList.contains("blog-post-page__reply-create-form")&&(o=t.nextSibling),o.classList.contains("-gone")?o.classList.remove("-gone"):o.classList.add("-gone")}));const o=e.querySelector(".comment-card__reply-button");o&&o.addEventListener("click",(()=>{const o=document.querySelector(".blog-post-page__reply-create-form");o?(o.previousSibling!==e&&l(e,t),o.parentElement.removeChild(o)):l(e,t)}));const r=e.querySelector(".comment-card__like-button"),a=e.querySelector(".comment-card__dislike-button"),i=backendData.loginUser,d=t.reaction;let u=d?d._id:null;const m=d?d.reaction_type:null;let p=!1,f=!1;"Like"===m?(p=!0,r.classList.add("-colorful")):"Dislike"===m&&(f=!0,a.classList.add("-colorful"));let g=p,b=f;const _=e.querySelector(".comment-card__like-reaction-form");_.addEventListener("submit",(async e=>{e.preventDefault(),s(b,g,[r],[a]),b=!1,g=!g,void 0!==i&&n.enqueue((async()=>{await c(_,f,p,u,i,(e=>{u=e.reactionId})),f=!1,p=!p}))}));const y=e.querySelector(".comment-card__dislike-reaction-form");y.addEventListener("submit",(async e=>{e.preventDefault(),s(g,b,[a],[r]),g=!1,b=!b,void 0!==i&&n.enqueue((async()=>{await c(y,p,f,u,i,(e=>{u=e.reactionId})),p=!1,f=!f}))}))}function s(e,t,o,n){if(t)for(const e of o){e.classList.remove("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)-1}else if(e){for(const e of o){e.classList.add("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)+1}for(const e of n){e.classList.remove("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)-1}}else for(const e of o){e.classList.add("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)+1}}async function c(e,t,n,r,s,c){const l=`/users/${s.username}/reactions`;n?await o(`${l}/${r}`,"delete",e,c):t?await o(`${l}/${r}`,"put",e,c):await o(l,"post",e,c)}function l(e,t){const o=document.querySelector(".blog-post-page__comment-create-form").cloneNode(!0),n=document.createElement("input");n.name="reply-to",n.type="hidden",n.value=t._id,o.append(n),o.classList.remove("blog-post-page__comment-create-form"),o.classList.add("blog-post-page__reply-create-form"),a(o),e.parentElement.insertBefore(o,e.nextSibling)}function a(t){t.addEventListener("submit",(n=>{n.preventDefault(),o(`/blog-posts/${backendData.blogPost._id}/comments`,"post",t,(o=>{if(e("form-textarea","content",o.errors),!o.errors)if(t.classList.contains("blog-post-page__reply-create-form")){let e=t.nextSibling;e||(e=document.createElement("div"),e.classList.add("blog-post-page__reply-container"),t.parentElement.append(e));const n=e.querySelectorAll(".comment-card");e.innerHTML=o.renderedHTML,r(e.querySelector(".comment-card"),o.commentData);for(const t of n)e.append(t);e.classList.contains("-gone")&&e.classList.remove("-gone"),t.parentElement.removeChild(t)}else{const e=document.createElement("div");e.classList.add("blog-post-page__comment-string"),e.innerHTML=o.renderedHTML,r(e.querySelector(".comment-card"),o.commentData),t.parentElement.insertBefore(e,t.nextSibling)}}))}))}function i(e,t,o=!1){if(null===t)return;const n=Array.from(t.querySelectorAll(".blog-post-item"));if("title"===e)n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__title").textContent;return t.querySelector(".blog-post-item__title").textContent.localeCompare(o)}));else if("last-mod-date"===e)n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__last-modified").textContent;return d(t.querySelector(".blog-post-item__last-modified").textContent,o)}));else if(o)switch(e){case"publish-date":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__published").textContent;return d(t.querySelector(".blog-post-item__published").textContent,o)}));break;case"likes":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__likes .icon-element__label").textContent,n=t.querySelector(".blog-post-item__likes .icon-element__label").textContent;return parseInt(n)-parseInt(o)}));break;case"dislikes":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__dislikes .icon-element__label").textContent,n=t.querySelector(".blog-post-item__dislikes .icon-element__label").textContent;return parseInt(n)-parseInt(o)}));break;case"total-comments":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__total-comments .icon-element__label").textContent,n=t.querySelector(".blog-post-item__total-comments .icon-element__label").textContent;return parseInt(n)-parseInt(o)}))}t.innerHTML="",t.append(...n)}function d(e,t){const o=e.split("-").map((e=>parseInt(e))),n=t.split("-").map((e=>parseInt(e)));let r=0;for(let e=0;e<o.length;e++){if(o[e]<n[e]){r=-1;break}if(o[e]>n[e]){r=1;break}}return r}function u(e,t){if(null===t)return;const o=t.querySelectorAll(".blog-post-item"),n=document.querySelector(".user-blog-posts__right");for(const r of o)r.addEventListener("click",(t=>{m(t,e,n)})),r.querySelector(".blog-post-item__delete-button").addEventListener("click",(e=>{e.stopPropagation(),p(r,t)}))}function m(e,t,o){const n=e.currentTarget.id,r=[...backendData.publishedBlogPosts,...backendData.unpublishedBlogPosts].find((e=>e._id.toString()===n));document.querySelector(".blog-post-fragment__title").innerHTML=r.title;const s=document.querySelector(".blog-post-fragment__thumbnail");if(s.innerHTML="",r.thumbnail){const e=r.thumbnail,t=`data:${e.contentType};base64,${e.data}`,o=document.createElement("img");o.src=t,s.classList.remove("-empty"),s.append(o)}else s.classList.add("-empty"),s.textContent="Your thumbnail appears here";document.querySelector(".blog-post-fragment__content").innerHTML=r.content,o.classList.remove("-hidden");let c=getComputedStyle(document.documentElement).getPropertyValue("--bp1");c=parseInt(c,10),screen.width<=c&&t.classList.add("-right-view")}function p(e,t){fetch(window.location.href+"/"+e.id,{method:"DELETE"}).then((o=>{if(!o.ok)throw new Error(`HTTP error - Status: ${o.status}`);if(t.removeChild(e),0===t.childElementCount){const e=t.parentElement;e.removeChild(t);const o=document.createElement("p");o.textContent="You have no blog posts here.",e.append(o)}})).catch((e=>{throw e}))}!function(){const e=document.querySelector(".navbar");if(!e)return;const t=e.querySelector(".searchbar__input");if(!t)return;const o=document.querySelector(".navbar-dropdown-container");t.addEventListener("input",(()=>{const e=t.value.split(" ").filter((e=>e)).map((e=>encodeURIComponent(e)));if(!e.length)return void(o.innerHTML="");const n="/blog-posts?keywords="+e.join(",");fetch(n,{method:"GET"}).then((e=>{if(!e.ok)throw new Error(`HTTP error - Status: ${e.status}`);return e.json()})).then((e=>{o.innerHTML=e.renderedHTML})).catch((e=>{throw e}))})),t.addEventListener("blur",(t=>{const n=t.relatedTarget;n&&o.contains(n)||(o.classList.add("-gone"),e.classList.remove("-expanded-searchbar"))})),t.addEventListener("focus",(()=>{o.classList.remove("-gone")})),e.querySelector(".navbar__search-button").addEventListener("click",(()=>{e.classList.add("-expanded-searchbar"),t.focus()}));let n=getComputedStyle(document.documentElement).getPropertyValue("--bp0");n=parseInt(n,10)+1+"px",window.matchMedia(`(min-width: ${n})`).addEventListener("change",(()=>{e.classList.remove("-expanded-searchbar")}))}(),function(){const e=document.querySelector(".sidebar-container");if(!e)return;document.querySelector(".navbar__sidebar-button").addEventListener("click",(()=>{e.classList.contains("-gone")?e.classList.remove("-gone"):e.classList.add("-gone")}));const t=e.querySelector(".sidebar__account-section");if(!t)return;const o=t.querySelector(".sidebar__expandable");o.addEventListener("click",(()=>{const e=t.querySelector(".sidebar__collapsable"),n=o.querySelector(".icon-element__icon");e.classList.contains("-gone")?(e.classList.remove("-gone"),n.style.transform="rotate(180deg)"):(e.classList.add("-gone"),n.style.transform="none")}));const n=e.querySelector(".sidebar__content-section"),r=n.querySelector(".sidebar__expandable");r.addEventListener("click",(()=>{const e=n.querySelector(".sidebar__collapsable"),t=r.querySelector(".icon-element__icon");e.classList.contains("-gone")?(e.classList.remove("-gone"),t.style.transform="rotate(180deg)"):(e.classList.add("-gone"),t.style.transform="none")}))}(),function(){const t=document.querySelector(".logging-page");if(!t)return;const o=backendData.errors,n={username:{errors:[],formCompType:"form-input"},password:{errors:[],formCompType:"form-input"}},r=t.querySelector(".logging-form").action.split("/");if("login"===r[r.length-1])n.password.errors=o.map((e=>({msg:e})));else for(const e of o)n[e.path].errors.push(e);for(const[t,o]of Object.entries(n))e(o.formCompType,t,o.errors)}(),document.querySelector(".blog-post-page")&&(function(){const e=backendData.loginUser,t=backendData.blogPost.reaction;let o=t?t._id:null;const r=t?t.reaction_type:null,l=document.querySelectorAll(".blog-post__like-button");let a=!1;if("Like"===r){a=!0;for(const e of l)e.classList.add("-colorful")}const i=document.querySelectorAll(".blog-post__dislike-button");let d=!1;if("Dislike"===r){d=!0;for(const e of i)e.classList.add("-colorful")}let u=a,m=d;const p=document.querySelectorAll(".blog-post__like-reaction-form");for(const t of p)t.addEventListener("submit",(async r=>{r.preventDefault(),s(m,u,l,i),m=!1,u=!u,void 0!==e&&n.enqueue((async()=>{await c(t,d,a,o,e,(e=>{o=e.reactionId})),d=!1,a=!a}))}));const f=document.querySelectorAll(".blog-post__dislike-reaction-form");for(const t of f)t.addEventListener("submit",(async r=>{r.preventDefault(),s(u,m,i,l),u=!1,m=!m,void 0!==e&&n.enqueue((async()=>{await c(t,a,d,o,e,(e=>{o=e.reactionId})),a=!1,d=!d}))}))}(),a(document.querySelector(".blog-post-page__comment-create-form")),function(){const e=document.querySelectorAll(".comment-card"),t=backendData.blogPost.comments;for(let o=0,n=0,s=0;o<e.length;o++){const c=e[o];let l=t[n];const a=l.replies;a.length?s>0?(l=a[s-1],s++,s===a.length+1&&(s=0,n++)):s++:n++,r(c,l)}}()),document.querySelector(".blog-post-form-page")&&(function(e){if(!document.querySelector(e))return;let t=backendData.blogPost.content||"";tinymce.init({selector:e,license_key:"gpl",plugins:"lists link image table code help wordcount",menubar:"file edit view insert table tools help",toolbar:"undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | numlist bullist",promotion:!1,image_file_types:"jpeg,jpg,png,webp,gif",setup:e=>{e.on("init",(()=>{e.setContent(t),document.querySelector(".blog-post-fragment__content").innerHTML=e.getContent()})),e.on("change",(()=>{e.save(),document.querySelector(".blog-post-fragment__content").innerHTML=e.getContent()})),e.on("submit",(()=>{document.getElementById("word-count").value=e.plugins.wordcount.getCount()}))}})}(".tinymce-app"),function(){const e=document.querySelector(".blog-post-form-page");document.querySelector(".blog-post-form-page__preview-button").addEventListener("click",(()=>{e.classList.add("-preview-view"),e.classList.remove("-draft-view")})),document.querySelector(".blog-post-form-page__draft-button").addEventListener("click",(()=>{e.classList.add("-draft-view"),e.classList.remove("-preview-view")}));let t=getComputedStyle(document.documentElement).getPropertyValue("--bp1");t=parseInt(t,10)+1+"px",window.matchMedia(`(min-width: ${t})`).addEventListener("change",(()=>{e.classList.remove("-draft-view"),e.classList.remove("-preview-view")}))}(),function(){const e=document.querySelector(".blog-post-form__metadata"),t=document.querySelector(".blog-post-form__content"),o=document.querySelector(".blog-post-form-page__metadata-tab");o.classList.add("-bold");const n=document.querySelector(".blog-post-form-page__content-tab");o.addEventListener("click",(()=>{o.classList.add("-bold"),n.classList.remove("-bold"),t.classList.add("-gone"),e.classList.remove("-gone")})),n.addEventListener("click",(()=>{n.classList.add("-bold"),o.classList.remove("-bold"),e.classList.add("-gone"),t.classList.remove("-gone")}))}(),function(){const e=document.querySelector(".blog-post-fragment__title"),t=document.getElementById("title");e.textContent=t.value,t.addEventListener("change",(()=>{e.textContent=t.value}))}(),function(){const n=document.querySelector(".blog-post-form");function r(e){const t=n.querySelectorAll(".blog-post-form__pre-method");for(const e of t)n.removeChild(e);const o=document.createElement("input");o.classList.add("blog-post-form__pre-method"),o.name="pre-method",o.type="hidden",o.value=e,n.append(o)}document.querySelector(".blog-post-form__discard-button").addEventListener("click",(()=>{r("discard")})),document.querySelector(".blog-post-form__save-button").addEventListener("click",(()=>{r("save")})),document.querySelector(".blog-post-form__publish-button").addEventListener("click",(()=>{r("publish")})),n.addEventListener("keypress",(e=>{"Enter"===e.key&&e.preventDefault()})),n.addEventListener("submit",(async r=>{r.preventDefault();let s="PUT",c=window.location.href;if(!Object.keys(backendData.blogPost).length){s="POST";const e=c.split("/");e.pop(),c=e.join("/")}let l=!1;const a={title:{errors:[],formCompType:"form-input"},thumbnail:{errors:[],formCompType:"form-input"},keywords:{errors:[],formCompType:"form-textarea"},content:{errors:[],formCompType:"form-textarea"},"word-count":{errors:[],formCompType:null}},i=document.querySelector(".blog-post-form-page__metadata-tab"),d=document.querySelector(".blog-post-form-page__content-tab");if(await o(c,s,n,(t=>{l=!0;let o=!1,n=!1;const r=["title","thumbnail","keywords"],s=["content","word-count"];for(const e of t.errors)a[e.path].errors.push(e),!o&&r.includes(e.path)?o=!0:!n&&s.includes(e.path)&&(n=!0);o?i.classList.add("-error"):i.classList.remove("-error"),n?d.classList.add("-error"):d.classList.remove("-error"),a.content.errors.push(...a["word-count"].errors),delete a["word-count"];for(const[t,o]of Object.entries(a))e(o.formCompType,t,o.errors)})),!l){for(const[e,o]of Object.entries(a))t(o.formCompType,e);i.classList.remove("-error"),d.classList.remove("-error")}}))}()),function(){if(!document.querySelector(".profile-page"))return;const t=document.querySelector(".profile__edit-button");if(!t)return;const n=document.querySelector(".profile__secondary-content"),r=document.querySelector(".profile-form");t.addEventListener("click",(()=>{r.classList.contains("-gone")&&(n.classList.add("-gone"),r.classList.remove("-gone"))})),document.querySelector(".profile-form__cancel").addEventListener("click",(()=>{if(n.classList.contains("-gone")){r.classList.add("-gone"),n.classList.remove("-gone");const{username:e,bio:t,keywords:o}=backendData.user;document.getElementById("username").value=e,t&&(document.getElementById("bio").value=t),o.length&&(document.getElementById("keywords").value=o.join(" "))}})),r.addEventListener("submit",(t=>{t.preventDefault(),o(`/users/${backendData.user.username}`,"PUT",r,(t=>{const o={"profile-pic":{errors:[],formCompType:"form-input"},username:{errors:[],formCompType:"form-input"},bio:{errors:[],formCompType:"form-textarea"},keywords:{errors:[],formCompType:"form-textarea"}};for(const e of t.errors)o[e.path].errors.push(e);for(const[t,n]of Object.entries(o))e(n.formCompType,t,n.errors)}))}))}(),function(){const e=document.querySelector(".user-blog-posts-page");if(!e)return;!function(e){const t=e.querySelector(".user-blog-posts-page__searchbar .searchbar__input");t.addEventListener("input",(t=>{const o=e.querySelectorAll(".blog-post-item"),n=t.currentTarget.value.trim().toLowerCase();if(""===n)for(const e of o)e.classList.remove("-gone");else for(const e of o){const t=e.querySelector(".blog-post-item__title").textContent.toLowerCase();new RegExp(n).test(t)?e.classList.remove("-gone"):e.classList.add("-gone")}})),t.addEventListener("blur",(()=>{e.classList.remove("-expanded-searchbar")})),e.querySelector(".user-blog-posts-page__search-button").addEventListener("click",(()=>{e.classList.add("-expanded-searchbar"),t.focus()}));let o=getComputedStyle(document.documentElement).getPropertyValue("--bp0");o=parseInt(o,10)+1+"px",window.matchMedia(`(min-width: ${o})`).addEventListener("change",(()=>{e.classList.remove("-expanded-searchbar")}))}(e),function(e){const t=e.querySelector(".user-blog-posts-page__sort-selector"),o=e.querySelector(".user-blog-posts__published.blog-post-list"),n=e.querySelector(".user-blog-posts__unpublished.blog-post-list");t.addEventListener("change",(e=>{const t=e.target.value.trim().toLowerCase();i(t,o,!0),i(t,n)}))}(e),function(e){e.querySelector(".user-blog-posts-page__left-view-button").addEventListener("click",(()=>{e.classList.remove("-right-view")}));let t=getComputedStyle(document.documentElement).getPropertyValue("--bp1");t=parseInt(t,10)+1+"px",window.matchMedia(`(min-width: ${t})`).addEventListener("change",(()=>{e.classList.remove("-right-view")}))}(e),function(e){const t=e.querySelector(".user-blog-posts__published-container"),o=e.querySelector(".user-blog-posts__unpublished-container"),n=e.querySelector(".user-blog-posts__published-tab");n.classList.add("-bold");const r=e.querySelector(".user-blog-posts__unpublished-tab");n.addEventListener("click",(()=>{n.classList.add("-bold"),r.classList.remove("-bold"),o.classList.add("-gone"),t.classList.remove("-gone")})),r.addEventListener("click",(()=>{r.classList.add("-bold"),n.classList.remove("-bold"),t.classList.add("-gone"),o.classList.remove("-gone")}))}(e);const t=document.querySelector(".user-blog-posts__published"),o=document.querySelector(".user-blog-posts__unpublished");u(e,t),u(e,o)}()})();