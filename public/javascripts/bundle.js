(()=>{"use strict";function e(e,o,n){t(e,o);const r=`${e}__error-container`,s=document.getElementById(o).parentElement;if(n){const t=document.createElement("div");t.classList.add(r);for(const o of n){const n=document.createElement("div");n.classList.add(`${e}__error`),n.textContent=o.msg,t.append(n)}s.append(t)}}function t(e,t){const o=`${e}__error-container`,n=document.getElementById(t).parentElement,r=n.querySelector("."+o);r&&n.removeChild(r)}async function o(e,t,o,n=null){const r=await fetch(e,{method:t,body:new FormData(o)});if(!r.ok&&400!==r.status)throw new Error("HTTP error - Status 500");r.redirected&&(window.location.href===r.url?window.location.reload():window.location.href=r.url);const s=r.headers.get("content-type");s&&s.includes("application/json")&&n&&n(await r.json())}const n=function(){const e=function(){let e=null,t=null;return{enqueue:function(o){const n=function(e,t=null){return{value:e,next:t}}(o);e?(t.next=n,t=n):(e=n,t=n)},dequeue:function(){if(!e)return;const o=e;return e=e.next,e||(t=null),o.value},isEmpty:function(){return null===e}}}();let t=!1;return{enqueue:async function(o){if(e.enqueue(o),!t){for(t=!0;!e.isEmpty();){const t=e.dequeue();await t()}t=!1}}}}();function r(e,t){t.replies&&t.replies.length&&e.querySelector(".comment-card__view-replies-button").addEventListener("click",(()=>{const t=e.nextSibling;let o=t;t.classList.contains("blog-post-page__reply-create-form")&&(o=t.nextSibling),o.classList.contains("-gone")?o.classList.remove("-gone"):o.classList.add("-gone")}));const o=e.querySelector(".comment-card__reply-button");o&&o.addEventListener("click",(()=>{const o=document.querySelector(".blog-post-page__reply-create-form");o?(o.previousSibling!==e&&l(e,t),o.parentElement.removeChild(o)):l(e,t)}));const r=e.querySelector(".comment-card__like-button"),a=e.querySelector(".comment-card__dislike-button"),i=backendData.loginUser,u=t.reaction;let d=u?u._id:null;const m=u?u.reaction_type:null;let p=!1,f=!1;"Like"===m?(p=!0,r.classList.add("-colorful")):"Dislike"===m&&(f=!0,a.classList.add("-colorful"));let b=p,g=f;const _=e.querySelector(".comment-card__like-reaction-form");_.addEventListener("submit",(async e=>{e.preventDefault(),s(g,b,[r],[a]),g=!1,b=!b,void 0!==i&&n.enqueue((async()=>{await c(_,f,p,d,i,(e=>{d=e.reactionId})),f=!1,p=!p}))}));const y=e.querySelector(".comment-card__dislike-reaction-form");y.addEventListener("submit",(async e=>{e.preventDefault(),s(b,g,[a],[r]),b=!1,g=!g,void 0!==i&&n.enqueue((async()=>{await c(y,p,f,d,i,(e=>{d=e.reactionId})),p=!1,f=!f}))}))}function s(e,t,o,n){if(t)for(const e of o){e.classList.remove("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)-1}else if(e){for(const e of o){e.classList.add("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)+1}for(const e of n){e.classList.remove("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)-1}}else for(const e of o){e.classList.add("-colorful");const t=e.querySelector(".icon-element__label");t.textContent=parseInt(t.textContent)+1}}async function c(e,t,n,r,s,c){const l=`/users/${s.username}/reactions`;n?await o(`${l}/${r}`,"delete",e,c):t?await o(`${l}/${r}`,"put",e,c):await o(l,"post",e,c)}function l(e,t){const o=document.querySelector(".blog-post-page__comment-create-form").cloneNode(!0),n=document.createElement("input");n.name="reply-to",n.type="hidden",n.value=t._id,o.append(n),o.classList.remove("blog-post-page__comment-create-form"),o.classList.add("blog-post-page__reply-create-form"),a(o),e.parentElement.insertBefore(o,e.nextSibling)}function a(t){t.addEventListener("submit",(n=>{n.preventDefault(),o(`/blog-posts/${backendData.blogPost._id}/comments`,"post",t,(o=>{if(e("form-textarea","content",o.errors),!o.errors)if(t.classList.contains("blog-post-page__reply-create-form")){let e=t.nextSibling;e||(e=document.createElement("div"),e.classList.add("blog-post-page__reply-container"),t.parentElement.append(e));const n=e.querySelectorAll(".comment-card");e.innerHTML=o.renderedHTML,r(e.querySelector(".comment-card"),o.commentData);for(const t of n)e.append(t);e.classList.contains("-gone")&&e.classList.remove("-gone"),t.parentElement.removeChild(t)}else{const e=document.createElement("div");e.classList.add("blog-post-page__comment-string"),e.innerHTML=o.renderedHTML,r(e.querySelector(".comment-card"),o.commentData),t.parentElement.insertBefore(e,t.nextSibling)}}))}))}function i(e,t,o=!1){if(null===t)return;const n=Array.from(t.querySelectorAll(".blog-post-item"));if("title"===e)n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__title").textContent;return t.querySelector(".blog-post-item__title").textContent.localeCompare(o)}));else if("last-mod-date"===e)n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__last-modified").textContent;return u(t.querySelector(".blog-post-item__last-modified").textContent,o)}));else if(o)switch(e){case"publish-date":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__published").textContent;return u(t.querySelector(".blog-post-item__published").textContent,o)}));break;case"likes":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__likes .icon-element__label").textContent,n=t.querySelector(".blog-post-item__likes .icon-element__label").textContent;return parseInt(n)-parseInt(o)}));break;case"dislikes":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__dislikes .icon-element__label").textContent,n=t.querySelector(".blog-post-item__dislikes .icon-element__label").textContent;return parseInt(n)-parseInt(o)}));break;case"total-comments":n.sort(((e,t)=>{const o=e.querySelector(".blog-post-item__total-comments .icon-element__label").textContent,n=t.querySelector(".blog-post-item__total-comments .icon-element__label").textContent;return parseInt(n)-parseInt(o)}))}t.innerHTML="",t.append(...n)}function u(e,t){const o=e.split("-").map((e=>parseInt(e))),n=t.split("-").map((e=>parseInt(e)));let r=0;for(let e=0;e<o.length;e++){if(o[e]<n[e]){r=-1;break}if(o[e]>n[e]){r=1;break}}return r}function d(e){if(null===e)return;const t=e.querySelectorAll(".blog-post-item"),o=document.querySelector(".user-blog-posts__right");for(const n of t)n.addEventListener("click",(e=>{m(e,o)})),n.querySelector(".blog-post-item__delete-button").addEventListener("click",(t=>{t.stopPropagation(),p(n,e)}))}function m(e,t){const o=e.currentTarget.id,n=[...backendData.publishedBlogPosts,...backendData.unpublishedBlogPosts].find((e=>e._id.toString()===o));document.querySelector(".blog-post-fragment__title").innerHTML=n.title;const r=document.querySelector(".blog-post-fragment__thumbnail");if(r.innerHTML="",n.thumbnail){const e=n.thumbnail,t=`data:${e.contentType};base64,${e.data}`,o=document.createElement("img");o.src=t,r.classList.remove("-empty"),r.append(o)}else r.classList.add("-empty"),r.textContent="Your thumbnail appears here";document.querySelector(".blog-post-fragment__content").innerHTML=n.content,t.classList.remove("-hidden")}function p(e,t){fetch(window.location.href+"/"+e.id,{method:"DELETE"}).then((o=>{if(!o.ok)throw new Error(`HTTP error - Status: ${o.status}`);if(t.removeChild(e),0===t.childElementCount){const e=t.parentElement;e.removeChild(t);const o=document.createElement("p");o.textContent="You have no blog posts here.",e.append(o)}})).catch((e=>{throw e}))}!function(){const e=document.querySelector(".navbar");if(!e)return;const t=e.querySelector(".searchbar__input");if(!t)return;const o=document.querySelector(".navbar-dropdown-container");t.addEventListener("input",(()=>{const e=t.value.split(" ").filter((e=>e)).map((e=>encodeURIComponent(e)));if(!e.length)return void(o.innerHTML="");const n="/blog-posts?keywords="+e.join(",");fetch(n,{method:"GET"}).then((e=>{if(!e.ok)throw new Error(`HTTP error - Status: ${e.status}`);return e.json()})).then((e=>{o.innerHTML=e.renderedHTML})).catch((e=>{throw e}))})),t.addEventListener("blur",(e=>{const t=e.relatedTarget;t&&o.contains(t)||o.classList.add("-gone")})),t.addEventListener("focus",(()=>{o.classList.remove("-gone")}))}(),function(){const e=document.querySelector(".sidebar-container");if(!e)return;document.querySelector(".navbar__sidebar-button").addEventListener("click",(()=>{e.classList.contains("-gone")?e.classList.remove("-gone"):e.classList.add("-gone")}));const t=e.querySelector(".sidebar__account-section");if(!t)return;const o=t.querySelector(".sidebar__expandable");o.addEventListener("click",(()=>{const e=t.querySelector(".sidebar__collapsable"),n=o.querySelector(".icon-element__icon");e.classList.contains("-gone")?(e.classList.remove("-gone"),n.style.transform="rotate(180deg)"):(e.classList.add("-gone"),n.style.transform="none")}));const n=e.querySelector(".sidebar__content-section"),r=n.querySelector(".sidebar__expandable");r.addEventListener("click",(()=>{const e=n.querySelector(".sidebar__collapsable"),t=r.querySelector(".icon-element__icon");e.classList.contains("-gone")?(e.classList.remove("-gone"),t.style.transform="rotate(180deg)"):(e.classList.add("-gone"),t.style.transform="none")}))}(),function(){const t=document.querySelector(".logging-page");if(!t)return;const o=backendData.errors,n={username:{errors:[],formCompType:"form-input"},password:{errors:[],formCompType:"form-input"}},r=t.querySelector(".logging-form").action.split("/");if("login"===r[r.length-1])n.password.errors=o.map((e=>({msg:e})));else for(const e of o)n[e.path].errors.push(e);for(const[t,o]of Object.entries(n))e(o.formCompType,t,o.errors)}(),document.querySelector(".blog-post-page")&&(function(){const e=backendData.loginUser,t=backendData.blogPost.reaction;let o=t?t._id:null;const r=t?t.reaction_type:null,l=document.querySelectorAll(".blog-post__like-button");let a=!1;if("Like"===r){a=!0;for(const e of l)e.classList.add("-colorful")}const i=document.querySelectorAll(".blog-post__dislike-button");let u=!1;if("Dislike"===r){u=!0;for(const e of i)e.classList.add("-colorful")}let d=a,m=u;const p=document.querySelectorAll(".blog-post__like-reaction-form");for(const t of p)t.addEventListener("submit",(async r=>{r.preventDefault(),s(m,d,l,i),m=!1,d=!d,void 0!==e&&n.enqueue((async()=>{await c(t,u,a,o,e,(e=>{o=e.reactionId})),u=!1,a=!a}))}));const f=document.querySelectorAll(".blog-post__dislike-reaction-form");for(const t of f)t.addEventListener("submit",(async r=>{r.preventDefault(),s(d,m,i,l),d=!1,m=!m,void 0!==e&&n.enqueue((async()=>{await c(t,a,u,o,e,(e=>{o=e.reactionId})),a=!1,u=!u}))}))}(),a(document.querySelector(".blog-post-page__comment-create-form")),function(){const e=document.querySelectorAll(".comment-card"),t=backendData.blogPost.comments;for(let o=0,n=0,s=0;o<e.length;o++){const c=e[o];let l=t[n];const a=l.replies;a.length?s>0?(l=a[s-1],s++,s===a.length+1&&(s=0,n++)):s++:n++,r(c,l)}}()),document.querySelector(".blog-post-form-page")&&(function(e){if(!document.querySelector(e))return;let t=backendData.blogPost.content||"";tinymce.init({selector:e,license_key:"gpl",plugins:"lists link image table code help wordcount",menubar:"file edit view insert table tools help",toolbar:"undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | numlist bullist",promotion:!1,image_file_types:"jpeg,jpg,png,webp,gif",setup:e=>{e.on("init",(()=>{e.setContent(t),document.querySelector(".blog-post-fragment__content").innerHTML=e.getContent()})),e.on("change",(()=>{e.save(),document.querySelector(".blog-post-fragment__content").innerHTML=e.getContent()})),e.on("submit",(()=>{document.getElementById("word-count").value=e.plugins.wordcount.getCount()}))}})}(".tinymce-app"),function(){const e=document.querySelector(".blog-post-form__metadata"),t=document.querySelector(".blog-post-form__content"),o=document.querySelector(".blog-post-form-page__metadata-tab");o.classList.add("-bold");const n=document.querySelector(".blog-post-form-page__content-tab");o.addEventListener("click",(()=>{o.classList.add("-bold"),n.classList.remove("-bold"),t.classList.add("-gone"),e.classList.remove("-gone")})),n.addEventListener("click",(()=>{n.classList.add("-bold"),o.classList.remove("-bold"),e.classList.add("-gone"),t.classList.remove("-gone")}))}(),function(){const e=document.querySelector(".blog-post-fragment__title"),t=document.getElementById("title");e.textContent=t.value,t.addEventListener("change",(()=>{e.textContent=t.value}))}(),function(){const n=document.querySelector(".blog-post-form");function r(e){const t=n.querySelectorAll(".blog-post-form__pre-method");for(const e of t)n.removeChild(e);const o=document.createElement("input");o.classList.add("blog-post-form__pre-method"),o.name="pre-method",o.type="hidden",o.value=e,n.append(o)}document.querySelector(".navbar__discard-button").addEventListener("click",(()=>{r("discard")})),document.querySelector(".navbar__save-button").addEventListener("click",(()=>{r("save")})),document.querySelector(".navbar__publish-button").addEventListener("click",(()=>{r("publish")})),n.addEventListener("keypress",(e=>{"Enter"===e.key&&e.preventDefault()})),n.addEventListener("submit",(async r=>{r.preventDefault();let s="PUT",c=window.location.href;if(!Object.keys(backendData.blogPost).length){s="POST";const e=c.split("/");e.pop(),c=e.join("/")}let l=!1;const a={title:{errors:[],formCompType:"form-input"},thumbnail:{errors:[],formCompType:"form-input"},keywords:{errors:[],formCompType:"form-textarea"},content:{errors:[],formCompType:"form-textarea"},"word-count":{errors:[],formCompType:null}},i=document.querySelector(".blog-post-form-page__metadata-tab"),u=document.querySelector(".blog-post-form-page__content-tab");if(await o(c,s,n,(t=>{l=!0;let o=!1,n=!1;const r=["title","thumbnail","keywords"],s=["content","word-count"];for(const e of t.errors)a[e.path].errors.push(e),!o&&r.includes(e.path)?o=!0:!n&&s.includes(e.path)&&(n=!0);o?i.classList.add("-error"):i.classList.remove("-error"),n?u.classList.add("-error"):u.classList.remove("-error"),a.content.errors.push(...a["word-count"].errors),delete a["word-count"];for(const[t,o]of Object.entries(a))e(o.formCompType,t,o.errors)})),!l){for(const[e,o]of Object.entries(a))t(o.formCompType,e);i.classList.remove("-error"),u.classList.remove("-error")}}))}()),function(){if(!document.querySelector(".profile-page"))return;const t=document.querySelector(".profile__edit-button");if(!t)return;const n=document.querySelector(".profile__secondary-content"),r=document.querySelector(".profile-form");t.addEventListener("click",(()=>{r.classList.contains("-gone")&&(n.classList.add("-gone"),r.classList.remove("-gone"))})),document.querySelector(".profile-form__cancel").addEventListener("click",(()=>{if(n.classList.contains("-gone")){r.classList.add("-gone"),n.classList.remove("-gone");const{username:e,bio:t,keywords:o}=backendData.user;document.getElementById("username").value=e,t&&(document.getElementById("bio").value=t),o.length&&(document.getElementById("keywords").value=o.join(" "))}})),r.addEventListener("submit",(t=>{t.preventDefault(),o(`/users/${backendData.user.username}`,"PUT",r,(t=>{const o={"profile-pic":{errors:[],formCompType:"form-input"},username:{errors:[],formCompType:"form-input"},bio:{errors:[],formCompType:"form-textarea"},keywords:{errors:[],formCompType:"form-textarea"}};for(const e of t.errors)o[e.path].errors.push(e);for(const[t,n]of Object.entries(o))e(n.formCompType,t,n.errors)}))}))}(),function(){if(!document.querySelector(".user-blog-posts-page"))return;document.querySelector(".user-blog-posts-page__searchbar .searchbar__input").addEventListener("input",(e=>{const t=document.querySelectorAll(".blog-post-item"),o=e.currentTarget.value.trim().toLowerCase();if(""===o)for(const e of t)e.classList.remove("-gone");else for(const e of t){const t=e.querySelector(".blog-post-item__title").textContent.toLowerCase();new RegExp(o).test(t)?e.classList.remove("-gone"):e.classList.add("-gone")}})),function(){const e=document.querySelector(".user-blog-posts-page__sort-selector"),t=document.querySelector(".user-blog-posts__published.blog-post-list"),o=document.querySelector(".user-blog-posts__unpublished.blog-post-list");e.addEventListener("change",(e=>{const n=e.target.value.trim().toLowerCase();i(n,t,!0),i(n,o)}))}(),function(){const e=document.querySelector(".user-blog-posts__published-container"),t=document.querySelector(".user-blog-posts__unpublished-container"),o=document.querySelector(".user-blog-posts__published-tab");o.classList.add("-bold");const n=document.querySelector(".user-blog-posts__unpublished-tab");o.addEventListener("click",(()=>{o.classList.add("-bold"),n.classList.remove("-bold"),t.classList.add("-gone"),e.classList.remove("-gone")})),n.addEventListener("click",(()=>{n.classList.add("-bold"),o.classList.remove("-bold"),e.classList.add("-gone"),t.classList.remove("-gone")}))}();const e=document.querySelector(".user-blog-posts__published"),t=document.querySelector(".user-blog-posts__unpublished");d(e),d(t)}()})();