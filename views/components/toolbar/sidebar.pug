include ../list/iconElementList
include ../icon/imgIconElement
include ../icon/svgIconElement
include ../icon/svg/profileIcon
include ../icon/svg/expandIcon
include ../icon/svg/blogPostIcon

nav.sidebar
    +imgIconElement(
        'a',
        '/images/favicon.png', 
        'Tech Stack',
        {
            'href': '/',
            'class': [
                'sidebar__index-link',
                '-gap-small'
            ]
        }
    )

    if !loginUser
        .sidebar__account-prompt.account-prompt
            .account-prompt__login
                .account-prompt__text Log in for read history and suggestions
                a.account-prompt__link(href='/login' class='-button -colorful') Log in
            .account-prompt__text OR
            .account-prompt__signup
                .account-prompt__text Not a member?
                a.account-prompt__link(href='/signup' class='-button -colorful') Sign Up

    else 
        section.sidebar__account-section
            button.sidebar__expandable
                h2.sidebar__heading Account
                +svgIconElement(
                    'div',
                    'expandIcon',
                    null,
                    {
                        'class': '-small'
                    }
                )
            .sidebar__collapsable.-gone
                - let iconElementType = 'svgIconElement'
                - let icon = 'profileIcon'
                - const classes = ['sidebar__profile-overview', '-large']

                if loginUser.profile_pic
                    - const pic = loginUser.profile_pic
                    - const base64 = pic.data.toString('base64')
                    - icon = `data:${pic.contentType};base64,${base64}`
                    - iconElementType = 'imgIconElement'
                    - classes.push('-avatar')
                    
                +#{iconElementType}(
                    'div',
                    icon,
                    loginUser.username,
                    {
                        'class': classes
                    }
                )

                +iconElementList(
                    [{
                        'type': 'svgIconElement',
                        'tag': 'a',
                        'icon': 'profileIcon',
                        'label': 'Your Profile',
                        'attrs': {
                            'href': `/users/${loginUser.username}`,
                        }
                    },
                    {
                        'type': 'svgIconElement',
                        'tag': 'a',
                        'icon': 'blogPostIcon',
                        'label': 'Your Blog Posts',
                        'attrs': {
                            'href': `/users/${loginUser.username}/blog-posts`,
                        }
                    }],
                    {
                        'iconElementList': {
                            'class': [
                                '-gap-small',
                                '-column',
                                '-align-start'
                            ]
                        },
                        'iconElement': {
                            'class': '-gap-small'
                        }
                    }
                )
                .sidebar__logout
                    a(href='/logout') Logout
        
        section.sidebar__content-section
            button.sidebar__expandable
                h2.sidebar__heading Content
                +svgIconElement(
                    'div',
                    'expandIcon',
                    null,
                    {
                        'class': '-small'
                    }
                )
            .sidebar__collapsable.-gone
                section.sidebar__subsection
                    h3.sidebar__subheading Recent
                    .sidebar__content
                        - const recentReads = loginUser.blog_posts_recently_read

                        if recentReads.length
                            - const recentReadsIconElements = []

                            each blogPost in recentReads
                                - let type = 'svgIconElement'
                                - let icon = 'profileIcon'
                                - const pic = blogPost.author.profile_pic

                                if pic
                                    - const base64 = pic.data.toString('base64')
                                    - icon = `data:${pic.contentType};base64,${base64}`
                                    - type = 'imgIconElement'
                                - 
                                    recentReadsIconElements.push(
                                        {
                                            'type': type,
                                            'tag': 'a',
                                            'icon': icon,
                                            'label': blogPost.title,
                                            'attrs': {
                                                'href': `/blog-posts/${blogPost._id}`,
                                            }
                                        }
                                    )
                            +iconElementList(
                                recentReadsIconElements,
                                {
                                    'iconElementList': {
                                        'class': [
                                            '-column',
                                            '-gap-small',
                                            '-align-start'
                                        ]
                                    },
                                    'iconElement': {
                                        'class': [
                                            '-gap-small',
                                        ]
                                    },
                                    'imgIconElement': {
                                        'class': [
                                            '-avatar'
                                        ]
                                    }
                                }
                            )
                        else 
                            | No recent reads available.

                section.sidebar__subsection
                    h3.sidebar__subheading Suggested
                    .sidebar__content
                        - const suggestionsIconElements = []

                        each blogPost in suggestions
                            - let type = 'svgIconElement'
                            - let icon = 'profileIcon'
                            - const pic = blogPost.author.profile_pic

                            if pic
                                - const base64 = pic.data.toString('base64')
                                - icon = `data:${pic.contentType};base64,${base64}`
                                - type = 'imgIconElement'
                            - 
                                suggestionsIconElements.push(
                                    {
                                        'type': type,
                                        'tag': 'a',
                                        'icon': icon,
                                        'label': blogPost.title,
                                        'attrs': {
                                            'href': `/blog-posts/${blogPost._id}`,
                                        }
                                    }
                                )
                        +iconElementList(
                            suggestionsIconElements,
                            {
                                'iconElementList': {
                                    'class': [
                                        '-column',
                                        '-gap-small',
                                        '-align-start'
                                    ]
                                },
                                'iconElement': {
                                    'class': [
                                        '-gap-small',
                                    ]
                                },
                                'imgIconElement': {
                                    'class': [
                                        '-avatar'
                                    ]
                                }
                            }
                        )